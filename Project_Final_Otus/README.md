# Переход от классической трехзвенной архитектуры к полноценной VxLan-фабрике с multisite


## Суть в чем, есть небольшой цод, работает на классической трехзвенчатой архитектуре, но

1) Появился запрос на горизонтальный трафик, заезжает клиент, со своей архитекрутрой, причем не один, ему нужно распределить его инфраструктуру в ЦОД(l2, l3, anycast gateway)

2) Он хочет, как и другие клиенты, георезервирование - получаем multisite

3) Выход на нескольких провайдеров - все нужно, пограничные анонсы, ытобы резервировать аплинки, анонс его сетей

4) Логичный запрос - резервирование серверов (MLAG, ESI-LAG)

## Цели

1) Использовать по максимуму все технологии освоенные в курсе

2) Закрепить на практике и в плане проектирования АБСОЛЮТНО все полученные знания

План такой

1) Смотрим что у нас сейчас, как реализована сеть, какое распределение VLAN, IP, peers

2) Простраиваем поверх текущего решения новое с фабрикой на multisite

3) Планируем работы, осуществляем переход от старого железного, к новому и современному, естественно с заделом на легкое масштабирование и увеличение количества и размеров наших ЦОД

# Выполнение проектной работы

Наметим точки, которые нам требуются

1) Где мы сейчас

2) Куда мы стремимся

3) Как мы к этому придем

## Где мы сейчас ?

Схема текущей сети

![](img/Schema_new.png)

Имеем классическую архитектуру, в трафиком N-S. Терминацией вланов mlag от уровня агрегации доступа и SVI на каждую подсеть. Между Site у нас голый L2 Vlan, с STP в кольцо, что не совсем хорошо, одно плечо простаивает, резервирование есть, но пути прохождения трафика неоптимальные, быстрый переход сложен, нам будет мешать STP

Собираем эту схему, в базовом виде

Конфигурации тут ***

## Куда мы стремимся ?

Видим следующие проблемы:

1) Остутствует корректная возможность изоляции L2 - у нас влан растянутый между site - потенциальные проблемы с STP
2) Все замыкается на GW - у нас весь трафик так или иначе заворачивается на корневой роутер, крутится там и передается дальше, по хорошему, нам нужно дать возможность трафику ходить горизонтально, только при необходимости - между SITE
3) L3-трафик имеет такую зе проблему, все оседает на GW - туда он должен выходить только при ситуации - когда надо передать трафик в условный интернет.

Схема новой сети сети

![](img/Schema.png)

## План перехода

1) Строим новую сеть поверх старой, благо оборудование имеет и портовую емкость для создания Underlay/Overlay
2) Проверяем связность горизонтального трафика, вертикального, L2 и L3 между Site
3) Открепляем вланы от старой системы, прикрепляем их на работу новой фабрики
4) проверяем работоспособность

## Осуществляем переход

1) Простраиваем связность каждого из SITE - проверяем связность внутри каждого из DC

2) Связываем SITE - смотрим связность между ними, как по L2 так и по L3

3) Осуществляем переход

Конфигурационные файлы

Таблица IP
