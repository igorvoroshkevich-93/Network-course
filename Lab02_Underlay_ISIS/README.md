# Домашнее задание 3 Underlay. IS-IS

## Цель: Настроить IS-IS для Underlay сети.

**Описание/Пошаговая инструкция выполнения домашнего задания:**
В этой самостоятельной работе мы ожидаем, что вы самостоятельно:

1. Настроите ISIS в Underlay сети, для IP связанности между всеми сетевыми устройствами.
2. Зафиксируете в документации - план работы, адресное пространство, схему сети, конфигурацию устройств
3. Убедитесь в наличии IP связанности между устройствами в ISIS домене

# Выполнение Задания

При инициализации лабораторного стенда немного поменялись порты, актуализируем схему и табличку

## Новая схема сети

![OSPF_EVE.png](OSPF_EVE.png)

## Таблица распределения адресного пространства

|Device  |Port     |IPv4                               |IPv6                      |VLAN|Link                           |Comment         |
|--------|---------|-----------------------------------|--------------------------|----|-------------------------------|----------------|
|Spine_1 |eth1     |  10.2.0.0/31                      |10:2::0/127---------------|911  |Spine_1 eth1 – eth1 Leaf_1    |  Interconnect  |
|Spine_1 |eth2     |  10.2.0.2/31                      |10:2::0/127---------------|911  |Spine_1 eth2 – eth1 Leaf_2    |  Interconnect  |
|Spine_1 |eth3     |  10.2.0.4/31                      |10:2::0/127---------------|911  |Spine_1 eth3 – eth1 Leaf_3    |  Interconnect  |
|Spine_1 |loopback0|  10.0.0.0/32                      |10:0::0/128---------------| --  | None                         |  Loopback      |
|Spine_1 |loopback1|  10.1.0.0/32                      |10:1::0/128---------------| --  | None                         |  Loopback      |
|Spine_2 |eth1     |  10.2.1.0/31                      |--------------------------|911  |Spine_2 eth1 – eth2 Leaf_1    |  Interconnect  |
|Spine_2 |eth2     |  10.2.1.2/31                      |--------------------------|911  |Spine_2 eth2 – eth2 Leaf_2    |  Interconnect  |
|Spine_2 |eth3     |  10.2.1.4/31                      |--------------------------|911  |Spine_2 eth3 – eth2 Leaf_3    |  Interconnect  |
|Spine_2 |loopback0|  10.0.0.1/32                      |--------------------------| --  | None                         |  Loopback      |
|Spine_2 |loopback1|  10.1.0.1/32                      |--------------------------| --  | None                         |  Loopback      |
|Leaf_1  |eth1     |  10.2.0.1/31                      |--------------------------|911  |Leaf_1 eth1 – eth1 Spine_1    |  Interconnect  |
|Leaf_1  |eth2     |  10.2.1.1/31                      |--------------------------|911  |Leaf_1 eth2 – eth1 Spine_2    |  Interconnect  |
|Leaf_1  |eth7     |  None                             |--------------------------|903  |Leaf_1 eth7  – eth0 Client_1  |  Client        |
|Leaf_1  |loopback0|  10.0.0.32/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_1  |loopback1|  10.1.0.32/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_2  |eth1     |  10.2.0.3/31                      |--------------------------|911  |Leaf_2 eth1 – eth2 Spine_1    |  Interconnect  |
|Leaf_2  |eth2     |  10.2.1.3/31                      |--------------------------|911  |Leaf_2 eth2 – eth2 Spine_2    |  Interconnect  |
|Leaf_2  |eth7     |  None                             |--------------------------|903  |Leaf_2 eth7  – eth0 Client_2  |  Client        |
|Leaf_2  |loopback0|  10.0.0.33/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_2  |loopback1|  10.1.0.33/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_3  |eth1     |  10.2.0.5/31                      |--------------------------|911  |Leaf_3 eth1 – eth3 Spine_1    |  Interconnect  |
|Leaf_3  |eth2     |  10.2.1.5/31                      |--------------------------|911  |Leaf_3 eth2 – eth3 Spine_2    |  Interconnect  |
|Leaf_3  |loopback0|  10.0.0.34/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_3  |loopback1|  10.1.0.34/32                     |--------------------------| --  | None                         |  Loopback      |
|Leaf_3  |eth7     |  None                             |--------------------------|903  |Leaf_3 eth7  – eth0 Client_3  |  Client        |
|Leaf_3  |eth8     |  None                             |--------------------------|903  |Leaf_3 eth8  – eth0 Client_4  |  Client        |
|Client_1  |eth0     |  172.16.0.1/24                  |--------------------------|903  |Client_1 eth0 – eth7  Leaf_1  |  Client        |
|Client_2  |eth0     |  172.16.0.2/24                  |--------------------------|903  |Client_2 eth0 – eth7  Leaf_2  |  Client        |
|Client_3  |eth0     |  172.16.0.3/24                  |--------------------------|903  |Client_3 eth0 – eth7  Leaf_3  |  Client        |
|Client_4  |eth0     |  172.16.0.4/24                  |--------------------------|903  |Client_4 eth0 – eth8  Leaf_3  |  Client        |

Так же, в виду того, что у нас ISIS строит соседство с помощью Network Entity Title соотвествующего формата, вводим таблицу значений, шаблон следующий
AFI - оставляем неизменным - 49
Area ID - так же как и в прошлой лабе, берем 1й - 001
System ID - принцип следующий
1й октет - 0001 - Номер Узла, мы начинающая организация, берем 1й - 0001
2й октет - Номер POD - 0001
3й октет - Уникальный - 0000 и так далее, но 1XXX - Spine, 2XXX - Leaf, 0XXX - на всякий закрепим за SuperSpine
Selector - оставляем неизменным - 00

## Таблица NET

|Device  |NET                               |
|Spine_1 |  49.001.0001.0001.1000           |
|Spine_2 |  49.001.0001.0001.1001           |
|Leaf_1  |  49.001.0001.0001.2000           |
|Leaf_2  |  49.001.0001.0001.2001           |
|Leaf_3  |  49.001.0001.0001.2002           |



## План последующей конфигурации

Вланы на L3 интерфейсах снова не используем, пишет что версия образа не поддерживает.
В этот раз собираем дуалстек, IPv4/IPv6

1. Подключаемся к оборудованию.
2. Настраиваем hostname.
3. Так как у нас Arista - глобально включаем routing.
4. Конфигурируем интерфейсы согласно плана(eth, loopback).
5. Проверяем интерконнекты командой ping - убеждаемся в связности.
6. Настраиваем BFD, Authorization.
7. Добавляем все необходимыек нам интерфейсы в ISIS, не забываем настроить passive-interface на оборудовании.
8. Включаем процесс ISIS глобально, поднимаем от Leaf в сторону Spine функцию ECMP - в прошлый раз не делали, чтобы лифы могли добраться до соседнего лифа через любой из Spine-ов.
10. Проверяем лупбеки командой ping - убеждаемся в связности.

## Приступаем к выполнению

**Сконфигурируем Spine-1** 

**Spine-1**
```

```
**Leaf-1**
```

```

Пока штиль, ничего не происходит

Включаем захват трафика на Spine-1 Interface Et1 и ставим фильтр на OSPF

***Включаем глобально ISIS на Spine-1***

```

```
![ISIS_hello.png](ISIS_hello.png)

***Все так же тихо, пока идет только Hello от Spine-1, поднимаем конфигурацию на Leaf-1***

```

```


Магия, видим в захвате обмен пакетами LSP, соседство установилось. 
Прикладываем скрин захвата трафика в момент установления соседства

![ISIS_full.png](ISIS_full.png)

## Смотрим состояние соседства на оборудовании и маршрутную таблицу

**Leaf-1**

![ISIS_leaf-1.png](ISIS_leaf-1.png)

**Spine-1**

![ISIS_spine-1.png](ISIS_spine-1.png)

Так, вроде все хорошо, проверим связность лупбеков 0 и 1

![ISIS_ping.png](ISIS_ping.png)

все работает. 


## Аналогично поднимаем настройки для всех Leaf и Spine и проверим связность

Конфигурация [общим файлом](https://github.com/igorvoroshkevich-93/Network-course/blob/main/Lab02_Underlay_ISIS/ISIS_full_conf.md)

Проверим связность, пинганем с Leaf-3 всех

**Loopback's 0**
![ISIS_ping2.png](ISIS_ping2.png)
**Loopback's 1**
![ISIS_ping3.png](ISIS_ping3.png)

Все отлично, всех видим, все хорошо, ну и посмотрим на этом же лифе состояние OSPF

![ISIS_leaf-3.png](ISIS_leaf-3.png)

Выглядит все визуально хорошо.
